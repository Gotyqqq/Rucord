# Безопасность Rucord

## Можно ли через консоль браузера получить права мастера или владельца?

**Нет.** Все проверки прав выполняются **только на сервере**. Клиент (браузер) не может ни выдать себе права мастера, ни стать владельцем чужого сервера.

### Как это устроено

1. **Кто такой пользователь**  
   Сервер узнаёт пользователя только из **JWT-токена**: при каждом запросе и при подключении по WebSocket токен проверяется, из него берётся `user.id`. Подменить себя другим пользователем через консоль нельзя: токен подписан секретным ключом (JWT_SECRET), который хранится только на сервере в `.env`.

2. **Права мастера**  
   Список мастеров задаётся **только в .env** на сервере: `MASTER_USER_IDS=1,2,3`. Флаг `is_master` в ответе API — это результат проверки «есть ли `req.user.id` в этом списке». Добавить себя в список через браузер или запросы к API нельзя: сервер не принимает от клиента «сделай меня мастером».

3. **Владелец сервера**  
   Владелец (`owner_id`) задаётся **один раз при создании сервера** — в него подставляется `req.user.id` из токена. Нет API «передать владение» по запросу от клиента; изменение имени/удаление сервера разрешено только если `server.owner_id === req.user.id`, то есть снова по данным с сервера, а не из консоли.

4. **Роли и права**  
   Выдача ролей, кик, бан, мут и т.п. проверяются через `getUserPermissions(serverId, req.user.id)` — снова по идентификатору из JWT и данным в БД, без доверия к данным из браузера.

### Что нужно сделать при выкладке на сервер

1. **Задать свой JWT_SECRET в .env**  
   Длинная случайная строка, например:
   ```bash
   openssl rand -base64 32
   ```
   В production приложение не запустится со стандартным секретом.

2. **Хранить .env только на сервере**  
   Файл `.env` не должен попадать в git и не должен быть доступен по веб-адресу. В нём лежат `JWT_SECRET`, `MASTER_USER_IDS` и при необходимости ключи внешних API.

3. **HTTPS**  
   На реальном домене используйте HTTPS, чтобы токен и пароли не передавались в открытом виде.

4. **MASTER_USER_IDS**  
   Укажите через запятую только те `id` пользователей из БД, которым доверяете полный доступ ко всем серверам. Менять этот список можно только правкой `.env` на сервере и перезапуском.

## Кратко

- Через консоль браузера или подмену запросов **нельзя** стать мастером или владельцем чужого сервера: права считаются только на бэкенде по JWT и .env/БД.
- Защита держится на **секретном JWT_SECRET** и **недоступном снаружи .env**. Задайте свой JWT_SECRET и не светите .env — тогда приложение готово к выкладке с точки зрения описанных рисков.
